server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://grafhista:3100/loki/api/v1/push

scrape_configs:


# Collecting the HANA service-available trace file.
- job_name: services
  static_configs:
  - targets:
      - localhost 
    labels:
      job: service-available
      host: ext
      __path__: /var/log/*/system_availability_*.trc
  pipeline_stages:
  - match:
      selector: '{job="service-available"}'
      stages:
      - regex:
          expression: '^0;(?P<time>.*?\..{6});(?P<message>.*$)'

      - template:
          source: time
          template: '{{ Replace .Value " " "T" -1 }}000+01:00'

      - timestamp:
          source: time
          format: RFC3339Nano
          action_on_failure: skip


# Collecting HANA nameserver trace files.
- job_name: nameserver
  static_configs:
  - targets:
      - localhost
    labels:
      job: nameserver
      host: ext
      __path__: /var/log/*/nameserver*.trc
  pipeline_stages:
  - match:
      selector: '{job="nameserver"}'
      stages:
      - regex:
          expression: '^\[.+\]\{.+\}\[.+\] (?P<timestamp>.*?\..{6}) (?P<message>.*$)'

      - template:
          source: timestamp
          template: '{{ Replace .Value " " "T" -1 }}000+01:00'

      - timestamp:
          source: timestamp
          format: RFC3339Nano
          action_on_failure: skip



- job_name: messages
  static_configs:
  - targets:
      - localhost
    labels: 
      job: messages
      host: ext
      __path__: /var/log/sc/messages.txt
  pipeline_stages:
  - match:
      selector: '{job="messages"}'
      stages:
      - regex:
          expression: '^(?P<timestamp>.*?\..{6}\+\d{2}\:\d{2})(?P<message>.*$)'  

      - timestamp:
          source: timestamp
          format: RFC3339Nano
          action_on_failure: skip

